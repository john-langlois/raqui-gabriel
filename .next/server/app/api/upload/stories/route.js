(()=>{var a={};a.id=651,a.ids=[651],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:a=>{"use strict";a.exports=require("querystring")},12412:a=>{"use strict";a.exports=require("assert")},13440:a=>{"use strict";a.exports=require("util/types")},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},27910:a=>{"use strict";a.exports=require("stream")},28354:a=>{"use strict";a.exports=require("util")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:a=>{"use strict";a.exports=require("tls")},36686:a=>{"use strict";a.exports=require("diagnostics_channel")},41204:a=>{"use strict";a.exports=require("string_decoder")},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},54287:a=>{"use strict";a.exports=require("console")},55511:a=>{"use strict";a.exports=require("crypto")},57075:a=>{"use strict";a.exports=require("node:stream")},57975:a=>{"use strict";a.exports=require("node:util")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66988:(a,b,c)=>{"use strict";c.r(b),c.d(b,{handler:()=>M,patchFetch:()=>L,routeModule:()=>H,serverHooks:()=>K,workAsyncStorage:()=>I,workUnitAsyncStorage:()=>J});var d={};c.r(d),c.d(d,{POST:()=>G});var e=c(95736),f=c(9117),g=c(4044),h=c(39326),i=c(32324),j=c(261),k=c(54290),l=c(85328),m=c(38928),n=c(46595),o=c(3421),p=c(17679),q=c(41681),r=c(63446),s=c(86439),t=c(51356),u=c(4027),v=c(55511),w=c(61831);function x(a){return function(b){if(!b.token.startsWith("vercel_blob_client_"))throw new u.K4(`${a} must be called with a client token`);if(void 0!==b.addRandomSuffix||void 0!==b.allowOverwrite||void 0!==b.cacheControlMaxAge)throw new u.K4(`${a} doesn't allow \`addRandomSuffix\`, \`cacheControlMaxAge\` or \`allowOverwrite\`. Configure these options at the server side when generating client tokens.`)}}async function y(a){return globalThis.crypto.subtle.importKey("raw",new TextEncoder().encode(a),{name:"HMAC",hash:"SHA-256"},!1,["sign","verify"])}async function z(a,b){if(!globalThis.crypto)return v.createHmac("sha256",b).update(a).digest("hex");let c=await globalThis.crypto.subtle.sign("HMAC",await y(b),new TextEncoder().encode(a));return Buffer.from(new Uint8Array(c)).toString("hex")}async function A({token:a,signature:b,body:c}){if(!globalThis.crypto){let d=v.createHmac("sha256",a).update(c).digest("hex"),e=Buffer.from(d),f=Buffer.from(b);return e.length===f.length&&v.timingSafeEqual(e,f)}return await globalThis.crypto.subtle.verify("HMAC",await y(a),function(a){if(a.length%2!=0)throw RangeError("Expected string to be an even number of characters");let b=new Uint8Array(a.length/2);for(let c=0;c<a.length;c+=2)b[c/2]=Number.parseInt(a.substring(c,c+2),16);return Buffer.from(b)}(b),new TextEncoder().encode(c))}(0,u.lz)({allowedOptions:["contentType"],extraChecks:x("client/`put`")}),(0,u.FB)({allowedOptions:["contentType"],extraChecks:x("client/`createMultipartUpload`")}),(0,u.MX)({allowedOptions:["contentType"],extraChecks:x("client/`createMultipartUpload`")}),(0,u.qk)({allowedOptions:["contentType"],extraChecks:x("client/`multipartUpload`")}),(0,u.GT)({allowedOptions:["contentType"],extraChecks:x("client/`completeMultipartUpload`")}),(0,u.lz)({allowedOptions:["contentType"],extraChecks(a){if(void 0===a.handleUploadUrl)throw new u.K4("client/`upload` requires the 'handleUploadUrl' parameter");if(void 0!==a.addRandomSuffix||void 0!==a.createPutExtraChecks||void 0!==a.cacheControlMaxAge)throw new u.K4("client/`upload` doesn't allow `addRandomSuffix`, `cacheControlMaxAge` or `allowOverwrite`. Configure these options at the server side when generating client tokens.")},async getToken(a,b){var c,d;return D({handleUploadUrl:b.handleUploadUrl,pathname:a,clientPayload:null!=(c=b.clientPayload)?c:null,multipart:null!=(d=b.multipart)&&d,headers:b.headers})}});var B={generateClientToken:"blob.generate-client-token"};async function C({token:a,request:b,body:c,onBeforeGenerateToken:d,onUploadCompleted:e}){var f,g,h,i;let j=(0,u.o4)({token:a}),k=c.type;switch(k){case"blob.generate-client-token":{let{pathname:a,clientPayload:h,multipart:i}=c.payload,l=await d(a,h,i),m=null!=(f=l.tokenPayload)?f:h,{callbackUrl:n,...o}=l,p=n;e&&!p&&(p=function(a){let b=function(a){try{let b=new URL(a,"https://dummy.com");return b.pathname+b.search}catch{return null}}(a.url);if(!b)return void console.warn("onUploadCompleted provided but no callbackUrl could be determined. Please provide a callbackUrl in onBeforeGenerateToken or set the VERCEL_BLOB_CALLBACK_URL environment variable.");if(process.env.VERCEL_BLOB_CALLBACK_URL)return`${process.env.VERCEL_BLOB_CALLBACK_URL}${b}`;if("1"!==process.env.VERCEL)return void console.warn("onUploadCompleted provided but no callbackUrl could be determined. Please provide a callbackUrl in onBeforeGenerateToken or set the VERCEL_BLOB_CALLBACK_URL environment variable.");if("preview"===process.env.VERCEL_ENV){if(process.env.VERCEL_BRANCH_URL)return`https://${process.env.VERCEL_BRANCH_URL}${b}`;if(process.env.VERCEL_URL)return`https://${process.env.VERCEL_URL}${b}`}if("production"===process.env.VERCEL_ENV&&process.env.VERCEL_PROJECT_PRODUCTION_URL)return`https://${process.env.VERCEL_PROJECT_PRODUCTION_URL}${b}`}(b)),!e&&p&&console.warn("callbackUrl was provided but onUploadCompleted is not defined. The callback will not be handled.");let q=new Date,r=null!=(g=l.validUntil)?g:q.setSeconds(q.getSeconds()+3600);return{type:k,clientToken:await E({...o,token:j,pathname:a,onUploadCompleted:p?{callbackUrl:p,tokenPayload:m}:void 0,validUntil:r})}}case"blob.upload-completed":{let a="x-vercel-signature",d="credentials"in b?null!=(h=b.headers.get(a))?h:"":null!=(i=b.headers[a])?i:"";if(!d)throw new u.K4("Missing callback signature");if(!await A({token:j,signature:d,body:JSON.stringify(c)}))throw new u.K4("Invalid callback signature");return e&&await e(c.payload),{type:k,response:"ok"}}default:throw new u.K4("Invalid event type")}}async function D(a){let{handleUploadUrl:b,pathname:c}=a,d=!function(a){try{return new URL(a),!0}catch(a){return!1}}(b)?new URL(b,location.href).href:b,e={type:B.generateClientToken,payload:{pathname:c,clientPayload:a.clientPayload,multipart:a.multipart}},f=await (0,w.hd)(d,{method:"POST",body:JSON.stringify(e),headers:{"content-type":"application/json",...a.headers},signal:a.abortSignal});if(!f.ok)throw new u.K4("Failed to  retrieve the client token");try{let{clientToken:a}=await f.json();return a}catch(a){throw new u.K4("Failed to retrieve the client token")}}async function E({token:a,...b}){var c;if("undefined"!=typeof window)throw new u.K4('"generateClientTokenFromReadWriteToken" must be called from a server environment');let d=new Date;d.setSeconds(d.getSeconds()+30);let e=(0,u.o4)({token:a}),[,,,f=null]=e.split("_");if(!f)throw new u.K4(a?"Invalid `token` parameter":"Invalid `BLOB_READ_WRITE_TOKEN`");let g=Buffer.from(JSON.stringify({...b,validUntil:null!=(c=b.validUntil)?c:d.getTime()})).toString("base64"),h=await z(g,e);if(!h)throw new u.K4("Unable to sign client token");return`vercel_blob_client_${f}_${Buffer.from(`${h}.${g}`).toString("base64")}`}var F=c(10641);async function G(a){let b=await a.json();try{let c=await C({body:b,request:a,onBeforeGenerateToken:async a=>({allowedContentTypes:["image/jpeg","image/png","image/gif","image/webp"],tokenPayload:JSON.stringify({})}),onUploadCompleted:async({blob:a,tokenPayload:b})=>{console.log("Blob uploaded:",a.url)}});return F.NextResponse.json(c)}catch(a){return F.NextResponse.json({error:a.message},{status:400})}}let H=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/upload/stories/route",pathname:"/api/upload/stories",filename:"route",bundlePath:"app/api/upload/stories/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"/Users/johnlanglois/Documents/john-code/raquel-gabriel/app/api/upload/stories/route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:I,workUnitAsyncStorage:J,serverHooks:K}=H;function L(){return(0,g.patchFetch)({workAsyncStorage:I,workUnitAsyncStorage:J})}async function M(a,b,c){var d;let e="/api/upload/stories/route";"/index"===e&&(e="/");let g=await H.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:C}=g,D=(0,j.normalizeAppPath)(e),E=!!(y.dynamicRoutes[D]||y.routes[C]);if(E&&!x){let a=!!y.routes[C],b=y.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let F=null;!E||H.isDev||x||(F="/index"===(F=C)?"/":F);let G=!0===H.isDev||!E,I=E&&!G,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:y,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:G,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>H.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>H.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&B&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!E)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await H.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})},z),b}},l=await H.handleResponse({req:a,nextConfig:w,cacheKey:F,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:k,waitUntil:c.waitUntil});if(!E)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&E||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(b instanceof s.NoFallbackError||await H.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})}),E)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},73496:a=>{"use strict";a.exports=require("http2")},73566:a=>{"use strict";a.exports=require("worker_threads")},74075:a=>{"use strict";a.exports=require("zlib")},74998:a=>{"use strict";a.exports=require("perf_hooks")},77598:a=>{"use strict";a.exports=require("node:crypto")},78335:()=>{},78474:a=>{"use strict";a.exports=require("node:events")},79428:a=>{"use strict";a.exports=require("buffer")},79551:a=>{"use strict";a.exports=require("url")},81630:a=>{"use strict";a.exports=require("http")},84297:a=>{"use strict";a.exports=require("async_hooks")},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},91645:a=>{"use strict";a.exports=require("net")},94175:a=>{"use strict";a.exports=require("stream/web")},94735:a=>{"use strict";a.exports=require("events")},96487:()=>{}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[873,428,692,27],()=>b(b.s=66988));module.exports=c})();